define([],function(){var e={};e.each=function(e,t,n){var r={},i=Array.prototype.forEach;if(e==null)return;if(i&&e.forEach===i)e.forEach(t,n);else if(e.length===+e.length){for(var s=0,o=e.length;s<o;s++)if(s in e&&t.call(n,e[s],s,e)===r)return}else for(var u in e)if(e.hasOwnProperty(u)&&t.call(n,e[u],u,e)===r)return},e.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},e.sizeObject=function(e){var t=0,n;for(n in e)e.hasOwnProperty(n)&&(t+=1);return t},e.proxy=function(e,t){var n;return n=Array.prototype.slice.call(arguments,2),function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}};var t=function(){this.properties={}};t.prototype={set:function(e,t){this.properties[e]=t},has:function(e){return this.properties[e]!=undefined?!0:!1},getAll:function(){return this.properties},get:function(e){if(this.has(e))return this.properties[e];throw e+" is not set"},remove:function(e){if(this.has(e)){this.properties[e]=null;try{delete this.properties[e]}catch(t){}}}};var n=new t,r=new t,i=function(){return{publish:function(t,n,i){var s=r.get(t),u=0;return e.each(r.getAll(),function(r,a){e.each(r.getSubscribedEvents(),function(e,f){f==n&&(i=i||{},i.sender=t,s.addPublishedEvent(n),r.addReceivedEvent(t,n),r.executeEventCallbacks(n,i),u++,o.trigger("event-published",{sender:{namespace:"Mediator",method:"publish"},senderName:t,eventName:n,moduleName:a,eventData:i}))})}),u===0&&o.trigger("event-listener-not-found",{sender:{namespace:"Mediator",method:"publish"},senderName:t,eventName:n}),u},register:function(e,t){t=t||!0;if(!r.has(e)){var n=new s(e,t);return r.set(e,n),r.get(e)}throw e+" is registered already"},stop:function(e){r.remove(e)},request:function(t,i){if(n.has(i)){var s=n.get(i),o={};return e.each(s.modules,function(e){o[e]=r.get(e).module.executeResponseMethod(t,i)}),o}throw i+" is not registered as a response"},addResponse:function(e,t){return n.has(t)||n.set(t,{modules:[]}),n.get(t).modules.push(e),!0}}}(),s=function(e,t){this.id=e,this.subscribedEvents={},this.receivedEvents={},this.reservedEvents={},this.publishedEvents={},this.responseTo={},this.reservedRequests={},this.requestedResponse={},this.queriedRequest={},t===!0?this.currentStatus=this.STATUS.STARTED:this.currentStatus=this.STATUS.STOPPED};s.prototype={STATUS:{STOPPED:0,STARTED:1},resetVariables:function(e){this.events=e,this.receivedEvents=e,this.reservedEvents=e,this.publishedEvents=e,this.responseTo=e,this.reservedRequests=e,this.requestedResponse=e,this.queriedRequest=e,this.id=e},start:function(){this.resetVariables({}),this.events=[],this.currentStatus=this.STATUS.STARTED},getStatus:function(){return this.currentStatus},stop:function(){i.stop(this.getId()),this.resetVariables(null),this.subscribedEvents=null,this.status=this.STATUS.STOPPED,this.currentStatus=this.STATUS.STOPPED},subscribeOne:function(t,n,r){r!=undefined&&(n=e.proxy(n,r)),this.subscribedEvents[t]={callback:n},o.trigger("event-subscribed",{sender:{namespace:"Module",method:"subscribeOne"},moduleName:this.getId(),eventName:t})},subscribe:function(t){var n,r;for(n in t)t.hasOwnProperty(n)&&(r=t[n],e.isArray(r)?r.length>=2&&this.subscribeOne(n,r[0],r[1]):this.subscribeOne(n,r))},unsubscribe:function(e){if(this.subscribedEvents[e]!=undefined){this.subscribedEvents[e]=null;try{delete this.subscribedEvents[e]}catch(t){}return o.trigger("event-unsubscribed",{sender:{namespace:"Module",method:"unsubscribe"},moduleName:this.getId(),eventName:e}),!0}return!1},publish:function(e,t){if(this.hasReserved(e))return i.publish(this.id,e,t);throw e+" has not been reserved."},hasReserved:function(e){return this.reservedEvents[e]},reserveEvent:function(e){return this.reservedEvents[e]==undefined?(this.reservedEvents[e]=!0,this.publishedEvents[e]={count:0},!0):!1},reserveEvents:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.reserveEvent(e[t])},getId:function(){return this.id},getSubscribedEvents:function(t){t=t||!1;if(t){var n=[];return e.each(this.subscribedEvents,function(e){n.push(e)}),n}return this.subscribedEvents},subscribed:function(e){return this.subscribedEvents[e]!=undefined?!0:!1},addPublishedEvent:function(e){this.publishedEvents[e].count++},addReceivedEvent:function(e,t){this.receivedEvents[t]==undefined&&(this.receivedEvents[t]={senders:[]}),this.receivedEvents[t].senders.push(e)},hasSubscribedEvent:function(e){return this.subscribedEvents[e]==undefined?!1:!0},getSubscribedEvent:function(e){return this.hasSubscribedEvent(e)?this.subscribedEvents[e]:undefined},executeEventCallbacks:function(e,t){var n=this.getSubscribedEvent(e);n.callback(t)},getEventMap:function(){var t={};e.each(this.responseTo,function(e,n){e.responded&&(t[n]=e.responded)});var n=["subscribedEvents","publishedEvents","queriedRequest","receivedEvents","reservedEvents"],r;for(r in n)n.hasOwnProperty(r)&&e.sizeObject(this[n[r]])===0&&(this[n[r]]=undefined);return n=null,e.sizeObject(t)===0&&(t=undefined),{subscribedEvents:this.subscribedEvents,receivedEvents:this.receivedEvents,publishedEvents:this.publishedEvents,reservedEvents:this.reservedEvents,reservedRequest:this.reservedRequest,queriedRequest:this.queriedRequest,respondedResponse:t}},reserveRequest:function(e){return this.reservedRequest[e]==undefined&&(this.reservedRequest[e]=!0,this.queriedRequest[e]={count:0}),!0},hasResponse:function(e){return this.responseTo[e]!=undefined?!0:!1},resposneOne:function(t,n,r){this.hasResponse(t)||(r!=undefined&&(n=e.proxy(n,r)),this.responseTo[t]={callback:n,responded:0}),i.addResponse(this.getId(),t)},request:function(e){if(this.reservedRequest[e]!=undefined)return this.queriedRequest[e].count++,i.request(this.getId(),e);throw"Request "+e+" is not reserved."},response:function(t){var n,r;for(n in t)t.hasOwnProperty(n)&&(r=t[n],e.isArray(r)&&r.length==2?this.resposneOne(n,r[0],r[1]):this.responseOne(n,r))},executeResponseMethod:function(e,t){return this.responseTo[t].responded++,this.responseTo[t].callback(e)}};var o=function(){var t={},n={};return{on:function(e,t){if(typeof t=="function")return n[e]==undefined&&(n[e]=[]),n[e].push(t),!0;throw"_Mediator.on: supplied callback is not a valid function"},off:function(e,t){if(n[e]==undefined)throw"_Mediator.off: "+e+" doesn't exist";if(typeof t!="function")throw"_Mediator.off: supplied callback is not a valid function";var r=n[e],i;for(i in r)r.hasOwnProperty(i)&&r[i]===t&&(r[i]=null)},trigger:function(t,r){n[t]&&(r=r||{},e.each(n[t],function(e){typeof e=="function"&&e(r)}))},register:function(e){return i.register(e)},registerSingleton:function(e){return r.has(e)||i.register(e),r.get(e)},getEventMapOf:function(e){return r.has(e)?r.get(e).getEventMap():undefined},getEventMap:function(){var t={};return e.each(r.getAll(),function(e){t[e.getId()]=e.getEventMap()}),t},getListenersByEventName:function(t){var n=[];return e.each(r.getAll(),function(e){e.subscribed(t)&&n.push(e.getId())}),n},getReserverByEventName:function(t){var n=[];return e.each(r.getAll(),function(e){e.hasPromised(t)&&n.push(e.getId())}),n}}}();return o.Class={Module:s,Mediator:i},window.Backbone?Backbone.Galaxy=o:window.Galaxy=o,o});